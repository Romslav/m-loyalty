# Max Loyalty ‚Äî –°–∏—Å—Ç–µ–º–∞ –õ–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –†–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤

> **Multi-tenant SaaS –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞.
> –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å POS-—Å–∏—Å—Ç–µ–º–∞–º–∏ (iiko, R-Keeper), Telegram Mini App, –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥–æ—Å—Ç—è–º–∏.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/Romslav/m-loyalty.git
cd m-loyalty

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ dev-–æ–∫—Ä—É–∂–µ–Ω–∏—è (Docker)
make setup
make dev
```

**–°–µ—Ä–≤–∏—Å—ã –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:**
- Frontend: http://localhost:3001
- Backend API: http://localhost:3000
- Mailhog (email): http://localhost:8025
- MinIO (S3): http://localhost:9001
- PostgreSQL: localhost:5432
- Redis: localhost:6379

---

## üìã –û –ø—Ä–æ–µ–∫—Ç–µ

**Max Loyalty** ‚Äî —ç—Ç–æ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ—è–ª—å–Ω–æ—Å—Ç—å—é –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ –∏ –∫–∞—Ñ–µ. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

- üèÜ –ù–∞—á–∏—Å–ª—è—Ç—å –∏ —Å–ø–∏—Å—ã–≤–∞—Ç—å –±–∞–ª–ª—ã –≥–æ—Å—Ç—è–º —á–µ—Ä–µ–∑ –∫–∞—Å—Å–∏—Ä–æ–≤ –∏–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ POS
- üìä –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—ã –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ü§ñ –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –≥–æ—Å—Ç—è–º–∏ —á–µ—Ä–µ–∑ Telegram Bot –∏ Mini App
- üîå –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å iiko –∏ R-Keeper –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è POS-–ª–æ–≥–∏–∫–∏
- üè¢ –£–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∑–∞–≤–µ–¥–µ–Ω–∏—è–º–∏ –∏–∑ –æ–¥–Ω–æ–≥–æ Owner-–∫–∞–±–∏–Ω–µ—Ç–∞

### –ö–ª—é—á–µ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | Multi-tenant SaaS, Pooled DB |
| Backend | NestJS 10, TypeScript, Prisma ORM |
| Frontend | Next.js 14, React 18, shadcn/ui |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | PostgreSQL 15 (Neon.tech) |
| –ö—ç—à / –û—á–µ—Ä–µ–¥–∏ | Redis 7 (Upstash) + BullMQ |
| –î–µ–ø–ª–æ–π | Fly.io (API) + Vercel (Frontend) |
| Telegram | Bot API + Mini App (TWA) |
| POS | iiko webhook + R-Keeper DLL plugin |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | JWT RS256, argon2id, AES-256-GCM, MFA |
| –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ | GDPR, PCI DSS SAQ A, –§–ó-152 |

---

## üë• –†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```
Owner
  ‚îî‚îÄ‚îÄ Tenant (—Å–µ—Ç—å —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤)
        ‚îú‚îÄ‚îÄ RestaurantAdmin
        ‚îÇ     ‚îú‚îÄ‚îÄ Manager
        ‚îÇ     ‚îÇ     ‚îî‚îÄ‚îÄ Cashier
        ‚îÇ     ‚îî‚îÄ‚îÄ Cashier
        ‚îî‚îÄ‚îÄ Guest (–≥–æ—Å—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏—è)
```

| –†–æ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **Owner** | –í–ª–∞–¥–µ–ª–µ—Ü –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã. –£–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏, –≤–∏–¥–∏—Ç MRR/Churn, –º–æ–∂–µ—Ç impersonate |
| **RestaurantAdmin** | –í–ª–∞–¥–µ–ª–µ—Ü/–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–µ—Ç–∏. –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–≤–æ–µ–º—É —Ç–µ–Ω–∞–Ω—Ç—É |
| **Manager** | –ú–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–µ–¥–µ–Ω–∏—è. –ì–æ—Å—Ç–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, loyalty (–±–µ–∑ billing) |
| **Cashier** | –ö–∞—Å—Å–∏—Ä. –¢–æ–ª—å–∫–æ earn/redeem –±–∞–ª–ª–æ–≤, –ø–æ–∏—Å–∫ –≥–æ—Å—Ç—è |
| **Guest** | –ì–æ—Å—Ç—å. –¢–æ–ª—å–∫–æ —Å–≤–æ—è –∫–∞—Ä—Ç–∞ —á–µ—Ä–µ–∑ Telegram Mini App |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```
m-loyalty/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ api/              # NestJS Backend API
‚îÇ   ‚îú‚îÄ‚îÄ worker/           # BullMQ Worker (—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)
‚îÇ   ‚îú‚îÄ‚îÄ cron/             # CRON-–∑–∞–¥–∞—á–∏ (—ç–∫—Å–ø–∏—Ä–∞—Ü–∏—è, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞)
‚îÇ   ‚îî‚îÄ‚îÄ frontend/         # Next.js 14 Frontend
‚îú‚îÄ‚îÄ libs/
‚îÇ   ‚îú‚îÄ‚îÄ shared/           # –û–±—â–∏–µ —Ç–∏–ø—ã, —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ database/         # Prisma schema, migrations
‚îÇ   ‚îî‚îÄ‚îÄ telegram/         # Telegram Bot + Mini App
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îî‚îÄ‚îÄ pos-plugin/       # R-Keeper DLL Plugin (C#)
‚îú‚îÄ‚îÄ docs/                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (—Å–º. INDEX.md)
‚îú‚îÄ‚îÄ scripts/              # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ docker-compose.dev.yml
‚îú‚îÄ‚îÄ Makefile
‚îî‚îÄ‚îÄ README.md
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ [`docs/`](./docs/INDEX.md).

**–ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏:**
- [–ü–æ–ª–Ω—ã–π –æ–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](./docs/01-FULL-SYSTEM-OVERVIEW.md)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](./docs/17-ARCHITECTURE.md)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](./docs/16-PROJECT-STRUCTURE.md)
- [–ü—É—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏](./docs/15-DEVELOPMENT-PATH.md)
- [–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](./docs/blocks/02-DATABASE-SCHEMA.md)
- [Backend API](./docs/blocks/03-BACKEND-API.md)
- [POS-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è](./docs/blocks/04-POS-INTEGRATION.md)
- [Frontend Admin Panel](./docs/blocks/05-FRONTEND-ADMIN.md)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](./docs/blocks/14-SECURITY-COMPLIANCE.md)
- [–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞](./docs/blocks/13-INFRASTRUCTURE-DEVOPS.md)

---

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **NestJS 10** ‚Äî –º–æ–¥—É–ª—å–Ω—ã–π –º–æ–Ω–æ–ª–∏—Ç —Å DI-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º
- **Prisma 5** ‚Äî ORM, migrations, type-safe queries
- **PostgreSQL 15** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ë–î (Neon.tech –≤ prod)
- **Redis 7** ‚Äî –∫—ç—à, —Å–µ—Å—Å–∏–∏, rate limiting, BullMQ (Upstash –≤ prod)
- **BullMQ** ‚Äî –æ—á–µ—Ä–µ–¥–∏: transaction, notification, export, analytics, sync
- **JWT (RS256)** ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, refresh token rotation
- **argon2id** ‚Äî —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
- **Winston + Logtail** ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### Frontend
- **Next.js 14** ‚Äî App Router, SSR/SSG
- **React 18** ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, Suspense
- **shadcn/ui + Radix** ‚Äî UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **Tailwind CSS** ‚Äî —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- **Zustand** ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—Ç–µ–π—Ç
- **TanStack Query** ‚Äî data fetching, –∫—ç—à, optimistic updates
- **Recharts** ‚Äî –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –¥–∞—à–±–æ—Ä–¥—ã
- **React Hook Form + Zod** ‚Äî —Ñ–æ—Ä–º—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### Infrastructure
- **Fly.io** ‚Äî –¥–µ–ø–ª–æ–π API (3 VM: api, worker, cron)
- **Vercel** ‚Äî –¥–µ–ø–ª–æ–π Frontend
- **Neon.tech** ‚Äî PostgreSQL (serverless, autoscale)
- **Upstash** ‚Äî Redis (serverless, –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º)
- **Cloudflare R2** ‚Äî S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- **GitHub Actions** ‚Äî CI/CD pipeline
- **Better Stack** ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

---

## ‚ö° –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã

| –ü–ª–∞–Ω | –†–µ—Å—Ç–æ—Ä–∞–Ω—ã | –ì–æ—Å—Ç–µ–π | –¶–µ–Ω–∞/–º–µ—Å |
|------|-----------|--------|----------|
| FREE | 1 | 500 | 0 ‚ÇΩ |
| STANDARD | 1 | 2,000 | 4,000 ‚ÇΩ |
| MEDIUM | 3 | 6,000 | 12,000 ‚ÇΩ |
| PRO | 5 | 15,000 | 28,000 ‚ÇΩ |
| ULTIMATE | ‚àû | ‚àû | –¥–æ–≥–æ–≤–æ—Ä–Ω–∞—è |
| CUSTOM | –≥–∏–±–∫–æ | –≥–∏–±–∫–æ | ‚Äî |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **JWT RS256** ‚Äî –∞—Å—Å–∏–º–µ—Ç—Ä–∏—á–Ω—ã–µ –∫–ª—é—á–∏, access 5 –º–∏–Ω, refresh 14 –¥–Ω–µ–π
- **argon2id** ‚Äî —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (64MB –ø–∞–º—è—Ç–∏, 3 –∏—Ç–µ—Ä–∞—Ü–∏–∏)
- **AES-256-GCM** ‚Äî —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ PII –ø–æ–ª–µ–π (—Ç–µ–ª–µ—Ñ–æ–Ω, –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è)
- **MFA TOTP** ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è Owner –∏ Admin
- **RBAC + ABAC** ‚Äî 30 –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–∞–≤ —Å Redis-–∫—ç—à–µ–º
- **Cloudflare WAF** ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS –∏ –±–æ—Ç–æ–≤
- **GDPR compliant** ‚Äî Right to Erasure, –¥–∞–Ω–Ω—ã–µ –≤ EU
- **PCI DSS SAQ A** ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ–∫–µ–Ω—ã –∫–∞—Ä—Ç, no card storage

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

- üìÅ **17 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤** –≤ –ø–∞–ø–∫–µ `docs/`
- üéØ **~7.2 MB** —Å—É–º–º–∞—Ä–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- üî¢ **35+ Prisma –º–æ–¥–µ–ª–µ–π**
- üõ£ **150+ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**
- üß™ **80%+ coverage** Unit-—Ç–µ—Å—Ç–∞–º–∏
- üöÄ **500 RPS** ‚Äî —Ü–µ–ª–µ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–ø—Ä–∏–µ—Ç–∞—Ä–Ω–∞—è. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏—Ç–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ. –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ*
